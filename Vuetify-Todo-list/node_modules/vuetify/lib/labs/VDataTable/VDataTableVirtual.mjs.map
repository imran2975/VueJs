{"version":3,"file":"VDataTableVirtual.mjs","names":["VDataTableHeaders","VDataTableRows","VTable","createGroupBy","provideGroupBy","useGroupedItems","createHeaders","createSort","provideSort","useSortedItems","makeDataTableProps","makeDataTableVirtualProps","useVirtual","makeFilterProps","useFilter","provideDefaults","provideExpanded","provideSelection","useDataTableItems","useOptions","computed","shallowRef","toRef","convertToUnit","genericComponent","propsFactory","useRender","makeVDataTableVirtualProps","VDataTableVirtual","name","props","emits","value","click:row","e","setup","_ref","emit","slots","groupBy","sortBy","multiSort","mustSort","columns","showSelect","showExpand","items","filterKeys","map","c","key","search","filteredItems","sortByWithGroups","opened","extractRows","sortedItems","flatItems","allRows","containerRef","paddingTop","paddingBottom","startIndex","stopIndex","itemHeight","handleScroll","visibleItems","slice","page","itemsPerPage","hideNoData","noDataText","dataTableHeadersProps","filterProps","dataTableRowsProps","tableProps","_createVNode","_mergeProps","class","style","top","wrapper","height","fixedHeader","border","length","bottom"],"sources":["../../../src/labs/VDataTable/VDataTableVirtual.tsx"],"sourcesContent":["// Components\nimport { VDataTableHeaders } from './VDataTableHeaders'\nimport { VDataTableRows } from './VDataTableRows'\nimport { VTable } from '@/components/VTable'\n\n// Composables\nimport { createGroupBy, provideGroupBy, useGroupedItems } from './composables/group'\nimport { createHeaders } from './composables/headers'\nimport { createSort, provideSort, useSortedItems } from './composables/sort'\nimport { makeDataTableProps } from './VDataTable'\nimport { makeDataTableVirtualProps, useVirtual } from './composables/virtual'\nimport { makeFilterProps, useFilter } from '@/composables/filter'\nimport { provideDefaults } from '@/composables/defaults'\nimport { provideExpanded } from './composables/expand'\nimport { provideSelection } from './composables/select'\nimport { useDataTableItems } from './composables/items'\nimport { useOptions } from './composables/options'\n\n// Utlities\nimport { computed, shallowRef, toRef } from 'vue'\nimport { convertToUnit, genericComponent, propsFactory, useRender } from '@/util'\n\n// Types\nimport type { DataTableItem } from './types'\nimport type { VDataTableRowsSlots } from './VDataTableRows'\n\nexport type VDataTableVirtualSlots = VDataTableRowsSlots & {\n  top: []\n  headers: []\n  bottom: []\n}\n\nexport const makeVDataTableVirtualProps = propsFactory({\n  ...makeDataTableProps(),\n  ...makeDataTableVirtualProps(),\n  ...makeFilterProps(),\n}, 'v-data-table-virtual')\n\nexport const VDataTableVirtual = genericComponent<VDataTableVirtualSlots>()({\n  name: 'VDataTableVirtual',\n\n  props: makeVDataTableVirtualProps(),\n\n  emits: {\n    'update:modelValue': (value: any[]) => true,\n    'update:sortBy': (value: any) => true,\n    'update:options': (value: any) => true,\n    'update:groupBy': (value: any) => true,\n    'update:expanded': (value: any) => true,\n    'click:row': (e: Event, value: { item: DataTableItem }) => true,\n  },\n\n  setup (props, { emit, slots }) {\n    const { groupBy } = createGroupBy(props)\n    const { sortBy, multiSort, mustSort } = createSort(props)\n\n    const { columns } = createHeaders(props, {\n      groupBy,\n      showSelect: toRef(props, 'showSelect'),\n      showExpand: toRef(props, 'showExpand'),\n    })\n    const { items } = useDataTableItems(props, columns)\n\n    const filterKeys = computed(() => columns.value.map(c => 'columns.' + c.key))\n    const search = toRef(props, 'search')\n    const { filteredItems } = useFilter<DataTableItem>(props, items, search, { filterKeys })\n\n    provideSort({ sortBy, multiSort, mustSort })\n    const { sortByWithGroups, opened, extractRows } = provideGroupBy({ groupBy, sortBy })\n\n    const { sortedItems } = useSortedItems(filteredItems, sortByWithGroups, columns)\n    const { flatItems } = useGroupedItems(sortedItems, groupBy, opened)\n\n    const allRows = computed(() => extractRows(flatItems.value))\n\n    provideSelection(props, allRows)\n    provideExpanded(props)\n\n    const {\n      containerRef,\n      paddingTop,\n      paddingBottom,\n      startIndex,\n      stopIndex,\n      itemHeight,\n      handleScroll,\n    } = useVirtual(props, flatItems)\n\n    const visibleItems = computed(() => {\n      return flatItems.value.slice(startIndex.value, stopIndex.value)\n    })\n\n    useOptions({\n      sortBy,\n      page: shallowRef(1),\n      itemsPerPage: shallowRef(-1),\n      groupBy,\n      search,\n    })\n\n    provideDefaults({\n      VDataTableRows: {\n        hideNoData: toRef(props, 'hideNoData'),\n        noDataText: toRef(props, 'noDataText'),\n      },\n    })\n\n    useRender(() => {\n      const [dataTableHeadersProps] = VDataTableHeaders.filterProps(props)\n      const [dataTableRowsProps] = VDataTableRows.filterProps(props)\n      const [tableProps] = VTable.filterProps(props)\n\n      return (\n        <VTable\n          class={[\n            'v-data-table',\n            props.class,\n          ]}\n          style={[\n            { '--v-table-row-height': convertToUnit(itemHeight.value) },\n            props.style,\n          ]}\n          { ...tableProps }\n        >\n          {{\n            top: slots.top,\n            wrapper: () => (\n              <div\n                ref={ containerRef }\n                onScroll={ handleScroll }\n                class=\"v-table__wrapper\"\n                style={{\n                  height: convertToUnit(props.height),\n                }}\n              >\n                <table>\n                  <thead>\n                    <VDataTableHeaders\n                      { ...dataTableHeadersProps }\n                      sticky={ props.fixedHeader }\n                      v-slots={ slots }\n                    />\n                  </thead>\n                  <tbody>\n                    <tr style={{ height: convertToUnit(paddingTop.value), border: 0 }}>\n                      <td colspan={ columns.value.length } style={{ height: convertToUnit(paddingTop.value), border: 0 }}></td>\n                    </tr>\n\n                    <VDataTableRows\n                      { ...dataTableRowsProps }\n                      items={ visibleItems.value }\n                      v-slots={ slots }\n                    />\n\n                    <tr style={{ height: convertToUnit(paddingBottom.value), border: 0 }}>\n                      <td colspan={ columns.value.length } style={{ height: convertToUnit(paddingBottom.value), border: 0 }}></td>\n                    </tr>\n                  </tbody>\n                </table>\n              </div>\n            ),\n            bottom: slots.bottom,\n          }}\n        </VTable>\n      )\n    })\n  },\n})\n\nexport type VDataTableVirtual = InstanceType<typeof VDataTableVirtual>\n"],"mappings":"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"}